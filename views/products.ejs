
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecolink for life</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/fontawesome-free-6.6.0-web/css/all.css">
    <link rel="stylesheet" href="/main.css">
    
    <link rel="stylesheet" href="../function.js">
    <link rel="stylesheet" href="../main.js">
    

</head>
<body>
    <!-- HEADER -->
        <!-- HEADER -->
        <div class="header">
            <!-- Header-Logo -->
            
              <img src="/image/logo.jpg" alt="" class="logo-img">
              <h4 class="header-logo-text">Ecolink for life</h3>
            
            <div class="header-search">
             
              <!-- Header-Services -->
                <div class="header-service">
                  <div class="header-service-item">
                    <img class= "header-service-item-avatar-img" src="<%= session.user ? session.user.AnhAvatar : (session.businessUser ? session.businessUser.AnhLogo : '/avatar/default-avatar.jpg') %>" alt="Avatar">
                    <% if (session.user || session.businessUser) { %>
                      <span><%= session.user ? session.user.TenDangNhap : session.businessUser.TenDangNhap %></span>
                      <a href="/logout">Đăng xuất</a>
                  <% } else { %>
                      <a href="/us-log-in">Đăng nhập</a>
                  <% } %>
                  </div>
      
                  <div class="header-service-item">
                    <i class="fa-solid fa-question"></i>
                    <a class="active" href="#home">Hỗ trợ</a>
                  </div>
      
                  <div class="header-service-item">
                    <i class="fa-regular fa-bell"></i>
                    <a href="#about">Thông báo</a>
                  </div>
                  
                  
                  
                </div>
          
              <!-- Header-serach&cart -->
               <div class="header-search-and-cart">
                <!-- Header-Search-frame -->
                <div class="search-frame">
                  <form action="/products/search" method="get" >
                    <input class="header-search-input" type="text" name="keyword" placeholder="Tìm kiếm" >
                    <button type="submit" class="header-search-icon">
                      <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                  </form>
                  
                  <!--Search history-->
                  <div class="header__search-history">
                    <h3 class="header__search-history-heading">Lịch sử tìm kiếm </h3>
                    <ul class="header__search-history-list">
                        <li class="header__search-history-item">
                            <a href="" class="">Kem dưỡng da</a>
                        </li>
                        <li class="header__search-history-item">
                            <a href="" class="">Kem trị mụn</a>
                        </li>
                    </ul>
                  </div>
                </div>

                <script>
                  const searchInput = document.querySelector(".header-search-input");
                  const searchInputIcon = document.querySelector(".header-search-icon");
                  const searchForm = document.querySelector("form");

                    searchInput.addEventListener("keypress", function (event) {
                        // Kiểm tra nếu phím nhấn là Enter (mã phím 13)
                        if (event.key === "Enter") {
                            searchForm.submit();  // Gửi form khi Enter được nhấn
                        }
                    });

                    searchInputIcon.addEventListener("click", function () {
                        searchForm.submit();  // Gửi form khi icon được nhấn
                    });
                  </script>
      
                <!-- Cart -->
                <a href="/cart" class="header-icon-cart">
                  <i class="fa-solid fa-cart-shopping"></i>
                  <div class="cart-quantity">
                    <p class="cart-quantity-number">15</p>
                  </div>
                </a>
                <div class="product-in-cart">
                  <div class="product-in-cart-arrow"></div>
                  <ul class="product-in-cart-list">
                    <li class="product-in-cart-item">
                      <img src="/image/sp1.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Premium Vector</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp2.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Premium Vector</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp4.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Strawberry Milkshake Can Packaging Design</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp5.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Strawberry Milkshake Can Packaging Design</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp6.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Design for vitamins and supplements</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp7.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Design for vitamins and supplements</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp8.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Pamper your skin with the moisturizing effects of lemongrass Essential oil</div>
                    </li>
                    <li class="product-in-cart-item">
                      <img src="/image/sp9.jpg" alt="" class="product-in-cart-item-img">
                      <div class="product-in-cart-item-name">Pamper your skin with the moisturizing effects of lemongrass Essential oil</div>
                    </li>
                  </ul>
                </div>
      
               </div>
             
             <!-- NAVIGATION -->
           <div class="navigation">
            <ul class="navigation-list">
              <li id = "trang-chu" ><a id="" href="/" class="navigation-item">Trang chủ</a></li>
              <li id = "san-pham" ><a href="/products" class="navigation-item" >Sản phẩm</a></li>
              <li id = "dien-dan" ><a href="/forum" class="navigation-item">Diễn đàn</a></li>
              <li id = "blog" > <a href="/news" class="navigation-item">Bài Blog</a></li>
            </ul>
          </div>
            </div>
           
        </div>
  </div>
     <!-- Back ground -->
     <div class="body-background">
      <img class="body-background-img" src="../image/qc-sanpham.jpg" alt="">
      <div class="body-background-text">
        <h1 class="body-background-text-title">Ecolink for life</h1>
        <h4 class="body-background-text-title">Home - Shop - Green product</h1>
      </div>
     </div>
    <!-- MAIN CONTENT -->
     <div class="main-content">
      <div class="body row">
     
        <!-- SlideBar -->
         <div class="slide-bar col-lg-2">
           <div class="slide-bar-header">
             <i class="fa-solid fa-filter"></i>
             <h4 class="slide-bar-title">Bộ lọc tìm kiếm</h2>
           </div>
           <label class="container">Thực phẩm
             <input type="checkbox" value="TP" name="categories" <%= categories && categories.includes('TP') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Đồ uốn
             <input type="checkbox" value="DU" name="categories" <%= categories && categories.includes('DU') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Gia dụng
             <input type="checkbox" value="GD" name="categories" <%= categories && categories.includes('GD') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Mỹ phẩm
             <input type="checkbox" value="MP" name="categories" <%= categories && categories.includes('MP') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
   
           <label class="container">Chăm sóc cá nhân
             <input type="checkbox"  value="CSCN" name="categories" <%= categories && categories.includes('CSCN') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
   
           <label class="container">Thời trang
             <input type="checkbox" value="QA" name="categories" <%= categories && categories.includes('QA') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Thiết bị điện tử
             <input type="checkbox" value="TBDT" name="categories" <%= categories && categories.includes('TBDT') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Văn phòng phẩm
             <input type="checkbox" value="VPP" name="categories" <%= categories && categories.includes('VPP') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
           <label class="container">Khác
             <input type="checkbox" value="Khac" name="categories" <%= categories && categories.includes('Khac') ? 'checked' : '' %>>
             <span class="checkmark"></span>
           </label>
           
         </div>
         <script>
            // Lắng nghe sự kiện thay đổi trạng thái của checkbox
document.querySelectorAll('input[name="categories"]').forEach(checkbox => {
    checkbox.addEventListener('change', applyFilters);

    // Kiểm tra nếu checkbox đã được lưu trong sessionStorage
    const selectedCategories = JSON.parse(sessionStorage.getItem('selectedCategories')) || [];
    if (selectedCategories.includes(checkbox.value)) {
        checkbox.checked = true; // Nếu có, đánh dấu checkbox là checked
    }
});

// Xử lý khi người dùng thay đổi trạng thái của checkbox
function applyFilters() {
    // Lấy tất cả các checkbox đã chọn
    const selectedCategories = [];
    const checkboxes = document.querySelectorAll('input[name="categories"]:checked');
    
    checkboxes.forEach(checkbox => {
        selectedCategories.push(checkbox.value);
    });

    // Lưu danh sách các category đã chọn vào sessionStorage
    sessionStorage.setItem('selectedCategories', JSON.stringify(selectedCategories));

    // Tạo URL với tham số 'categories' là danh sách các giá trị được chọn
    const url = `/products/filter?categories=${selectedCategories.join(',')}`;

    // Điều hướng tới trang lọc với các tham số
    window.location.href = url;
}

// Kiểm tra nếu người dùng chuyển sang các trang khác (không phải trang lọc)
function clearFilterSession() {
    const currentPath = window.location.pathname;

    // Nếu không phải trang lọc, xóa sessionStorage
    if (currentPath !== '/products/filter') {
        sessionStorage.removeItem('selectedCategories');
        document.querySelectorAll('input[name="categories"]').forEach(checkbox => {
            checkbox.checked = false;  // Bỏ chọn tất cả checkbox
        });
    }
}

// Gọi hàm clearFilterSession khi trang được tải lại
window.addEventListener('load', clearFilterSession);


         </script>
         <!-- List Product -->
        <div class="body-main col-lg-10">
         <div class="body-list-range ">
           <p class="body-list-range-title">Sắp xếp theo</p>
           <div class="body-list-range-item list-range-active">Liên quan</div>
           <div class="body-list-range-item">Mới nhất</div>
           <div class="body-list-range-item">Bán chạy</div>
           <div class="body-list-range-item">Giá
             <i class="fa-solid fa-chevron-down"></i>
           </div>
         </div>
         <div class="body-list-products">
             <!-- Lưới sản phẩm -->
          <div class="row">
    
        <% products.forEach((product, index) => { %>
            <div class="col-lg-2">
                <a href="/product-detail/<%= product.MaSP  %>">
                    <div class="item 1">
                        <div class="body-list-product-item">
                            <div class="body-list-products-item-img">
                                <img src="/product_image/<%= product.HinhChinh %>" alt="<%= product.TENSP %>" class="product-list-img">
                            </div>
                            <div class="body-list-product-item-title"><%= product.TenSP %></div>
                            <div class="body-list-product-item-discount">15%</div>
                            <div class="body-list-products-item-price">
                                <%= new Intl.NumberFormat('vi-VN').format(product.DGBanMacDinh) %>
                                <div class="body-list-products-item-price-unit">đ</div>
                                <i class="fa-solid fa-tag"></i>
                            </div>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Mỗi 6 sản phẩm sẽ đóng và mở lại <div class="row"> -->
            <% if ((index + 1) % 6 === 0 && index !== products.length - 1) { %>
                </div><div class="row">
            <% } %>
        <% }); %>
</div>

       <!-- PAGE NUMBER -->
<div class="body-page-number">
  <!-- Left Arrow -->
  <i class="fa-solid fa-chevron-left" 
    <% if (page > 1) { %> 
        onclick="goToPage('<%= page - 1 %>')"
    <% } else { %>
        class="disabled"
    <% } %>
  ></i>

  <!-- Page Number List -->
  <ul class="body-page-number-list">
    <% for (let i = 1; i <= totalPages; i++) { %>
      <li class="body-page-number-item <% if (i === page) { %>page-number-active<% } %>">
        <a class="body-page-number-item" href="javascript:void(0);" onclick="goToPage('<%= i %>')"><%= i %></a>
      </li>
    <% } %>
  </ul>

  <!-- Right Arrow -->
  <i class="fa-solid fa-chevron-right"
    <% if (page < totalPages) { %>
        onclick="goToPage('<%= page + 1 %>')"
    <% } else { %>
        class="disabled"
    <% } %>
  ></i>
</div>

<link rel="stylesheet" href="chatbot.js">
<script type="module">
    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"
    Chatbot.init({
        chatflowid: "140ae8e9-704b-4685-8867-e2c580d9d721",
        apiHost: "http://localhost:3000",
        chatflowConfig: {
            // topK: 2
        },
        theme: {
            button: {
                backgroundColor: "#dcd8d8",
                right: 20,
                bottom: 20,
                size: 48, // small | medium | large | number
                dragAndDrop: true,
                iconColor: "black",
                customIconSrc: "https://i.pinimg.com/736x/f1/7d/db/f17ddb244e3f2f6a720e61cd3f8161fb.jpg",
                autoWindowOpen: {
                    autoOpen: true, //parameter to control automatic window opening
                    openDelay: 2, // Optional parameter for delay time in seconds
                    autoOpenOnMobile: false, //parameter to control automatic window opening in mobile
                    },
            },
            
            chatWindow: {
                showTitle: true,
                title: 'Ecolink for life',
                titleAvatarSrc: 'https://i.pinimg.com/736x/f1/7d/db/f17ddb244e3f2f6a720e61cd3f8161fb.jpg',
                showAgentMessages: true,
                welcomeMessage: 'Hello! How can I help you',
                errorMessage: 'Wait a minute! I will contact with EcoAssistant now.',
                backgroundColor: "#ffffff",
                backgroundImage: 'enter image path or link', // If set, this will overlap the background color of the chat window.
                height: 450,
                width: 350,
                fontSize: 16,
                //starterPrompts: ['What is a bot?', 'Who are you?'], // It overrides the starter prompts set by the chat flow passed
                starterPromptFontSize: 15,
                clearChatOnReload: false, // If set to true, the chat will be cleared when the page reloads.
                botMessage: {
                    backgroundColor: "#f7f8ff",
                    textColor: "#303235",
                    showAvatar: true,
                    avatarSrc: "https://i.pinimg.com/736x/f1/7d/db/f17ddb244e3f2f6a720e61cd3f8161fb.jpg",
                },
                userMessage: {
                    backgroundColor: "#007b59",
                    textColor: "#ffffff",
                    showAvatar: true,
                    avatarSrc: "https://i.pinimg.com/736x/2b/c9/05/2bc905c07667a2e70cc78fe0242b8d78.jpg",
                },
                textInput: {
                    placeholder: 'Type your question',
                    backgroundColor: '#ffffff',
                    textColor: '#303235',
                    sendButtonColor: '#007b59',
                    maxChars: 50,
                    maxCharsWarningMessage: 'You exceeded the characters limit. Please input less than 50 characters.',
                    autoFocus: true, // If not used, autofocus is disabled on mobile and enabled on desktop. true enables it on both, false disables it on both.
                    sendMessageSound: true,
                    // sendSoundLocation: "send_message.mp3", // If this is not used, the default sound effect will be played if sendSoundMessage is true.
                    receiveMessageSound: true,
                    // receiveSoundLocation: "receive_message.mp3", // If this is not used, the default sound effect will be played if receiveSoundMessage is true. 
                },
                feedback: {
                    color: '#303235',
                },
                footer: {
                    textColor: '#303235',
                    text: 'Powered by',
                    company: 'Ecolink for life',
                    companyLink: 'https://flowiseai.com',
                }
            }
        }
    })
</script>
<script>
  function goToPage(pageNumber) {
    // Lấy các tham số query hiện tại trong URL
    const urlParams = new URLSearchParams(window.location.search);

    // Kiểm tra URL hiện tại và xử lý các tham số
    let newUrl = window.location.pathname;

    // Nếu có tham số 'categories' hoặc 'keyword', giữ lại các tham số đó
    if (urlParams.has('categories')) {
      newUrl += `?categories=${urlParams.get('categories')}`;
    } else if (urlParams.has('keyword')) {
      newUrl += `?keyword=${urlParams.get('keyword')}`;
    }

    // Thêm tham số 'page' vào URL
    newUrl += newUrl.includes('?') ? `&page=${pageNumber}` : `?page=${pageNumber}`;

    // Điều hướng đến URL mới
    window.location.href = newUrl;
  }
</script>

      
     </div>
     <script type="text/javascript" src="../function.js"></script>

     <link rel="stylesheet" href="/product.css">
</body>
<%- include('layout/footer')  %>
</html>