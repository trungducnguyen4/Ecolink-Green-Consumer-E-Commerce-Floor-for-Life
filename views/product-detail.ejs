<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/fontawesome-free-6.6.0-web/css/all.css">
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/product-detail.css">
    
    <title><%= product.TenSP %></title>
    
    <title>Product-detail</title>
</head>
<body>
        <!-- HEADER -->
        <div class="header">
          <!-- Header-Logo -->
          
            <img src="/image/logo.jpg" alt="" class="logo-img">
            <h4 class="header-logo-text">Ecolink for life</h3>
          
          <div class="header-search">
           
            <!-- Header-Services -->
              <div class="header-service">
                <div class="header-service-item">
                  <img class= "header-service-item-avatar-img" src="/image/avatar.jpg" alt="">
                  <a href="http://127.0.0.1:5500/assets/personal.html">Ecolink</a>
                </div>
    
                <div class="header-service-item">
                  <i class="fa-solid fa-question"></i>
                  <a class="active" href="#home">Hỗ trợ</a>
                </div>
    
                <div class="header-service-item">
                  <i class="fa-regular fa-bell"></i>
                  <a href="#about">Thông báo</a>
                </div>
                <div class="header-service-item">
                  <i class="fa-solid fa-store"></i>
                  <a class="active" href="#home">Kênh người bán</a>
                </div>
                
                
              </div>
        
            <!-- Header-serach&cart -->
             <div class="header-search-and-cart">
              <!-- Header-Search-frame -->
              <div class="search-frame">
                <input class="header-search-input" type="text" placeholder="Tìm kiếm">
                <div class="header-search-icon">
                  <i class="fa-solid fa-magnifying-glass"></i>
                </div>
                <!--Search history-->
                <div class="header__search-history">
                  <h3 class="header__search-history-heading">Lịch sử tìm kiếm </h3>
                  <ul class="header__search-history-list">
                      <li class="header__search-history-item">
                          <a href="" class="">Kem dưỡng da</a>
                      </li>
                      <li class="header__search-history-item">
                          <a href="" class="">Kem trị mụn</a>
                      </li>
                  </ul>
                </div>
              </div>
    
              <!-- Cart -->
              <div class="header-icon-cart">
                <i class="fa-solid fa-cart-shopping"></i>
                <div class="cart-quantity">
                  <p class="cart-quantity-number">15</p>
                </div>
              </div>
              <div class="product-in-cart">
                <div class="product-in-cart-arrow"></div>
                <ul class="product-in-cart-list">
                  <li class="product-in-cart-item">
                    <img src="/image/sp1.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Premium Vector</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp2.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Premium Vector</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp4.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Strawberry Milkshake Can Packaging Design</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp5.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Strawberry Milkshake Can Packaging Design</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp6.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Design for vitamins and supplements</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp7.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Design for vitamins and supplements</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp8.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Pamper your skin with the moisturizing effects of lemongrass Essential oil</div>
                  </li>
                  <li class="product-in-cart-item">
                    <img src="/image/sp9.jpg" alt="" class="product-in-cart-item-img">
                    <div class="product-in-cart-item-name">Pamper your skin with the moisturizing effects of lemongrass Essential oil</div>
                  </li>
                </ul>
              </div>
    
             </div>
           
           <!-- NAVIGATION -->
         <div class="navigation">
          <ul class="navigation-list">
            <li id = "trang-chu" class="navigation-item">Trang chủ</li>
            <li id = "san-pham" class="navigation-item">Sản phẩm</li>
            <li id = "dien-dan" class="navigation-item">Diễn đàn</li>
            <li id = "blog" class="navigation-item">Bài Blog</li>
          </ul>
        </div>
          </div>
         
      </div>
       <!-- Back ground -->
       <div class="body-background">
        <img class="body-background-img" src="/image/qc-sanpham.jpg" alt="">
        <div class="body-background-text">
          <h1 class="body-background-text-title">Ecolink for life</h1>
          <h4 class="body-background-text-title">Home - Shop - Green product</h1>
        </div>
        </div>
    </div>
    <!-- MAIN BODY -->
     <div class="product-detail-body">
        <div class="product-detail">
            <img src="/product_image/<%= product.HinhChinh %>" alt="<%= product.TenSP %>" class="product-detail-img">
            <div class="product-detail-frame">
                <div class="product-detail-title"><%= product.TenSP %></div>
                <div class="product-detail-rate">
                  <% if (ratingCount > 0) { 
                    const fullStars = Math.floor(averageRating);
                    const halfStar = (averageRating - fullStars) >= 0.5;
                    const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                %>
                    <% for(let i = 0; i < fullStars; i++) { %>
                        <i class="fa-solid fa-star rate-active"></i>
                    <% } %>
                    <% if (halfStar) { %>
                        <i class="fa-solid fa-star-half-stroke rate-active"></i>
                    <% } %>
                    <% for(let i = 0; i < emptyStars; i++) { %>
                        <i class="fa-solid fa-star"></i>
                    <% } %>
                    <p class="product-detail-rate-number"><%= ratingCount %> đánh giá</p>
                <% } else { %>
                    <p class="product-detail-rate-number">Chưa có đánh giá</p>
                <% } %>
                </div>
                <div class="product-detail-price row">
                    <div class="product-detail-lable col-lg-2">Giá bán</div>
                    <div class="product-detail-price-wrap col-lg-10">
                      <div class="product-detail-price-number"><%= new Intl.NumberFormat('vi-VN').format(product.DGBanMacDinh) %></div>
                      <div class="product-detail-price-unit">đ</div>
                    </div>
                </div>

               
              
            <div class="product-detail-quantity row">
              <div class="product-detail-lable col-lg-2">Số lượng</div>
              <div class="quantity-control col-lg-10">
                  <button type="button" class="quantity-btn decrement" onclick="updateQuantity(-1)">−</button>
                  <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="<%= product.SoLuongTon %>">
                  <button type="button" class="quantity-btn increment" onclick="updateQuantity(1)">+</button>
              </div>
            </div>
            <% if (product.SoLuongTon > 0) { %>
                <div class="product-detail-buy">
                    <div class="product-detail-add-cart" onclick="addToCart('<%= product.MaSP %>', <%= product.DGBanMacDinh %>)">  
                        <i class="fa-solid fa-cart-plus"></i>
                        Thêm vào giỏ hàng
                    </div>
                    <div class="product-detail-buy-now">  
                        Mua ngay
                    </div>
                </div>
            <% } %>
            </div>
        </div>
       <div class="product-infor-frame">
        <!-- Thanh điều hướng -->
        <div class="line-infor">
          <div class="line-infor-left"></div>
          <div class="line-infor-item line-infor-item-active" onclick="showContent('describe')">Mô tả</div>
          <div class="line-infor-item" onclick="showContent('chungchi')">Chứng chỉ xanh</div>
          <div class="line-infor-item" onclick="showContent('danhgia')">Đánh giá</div>
          <div class="line-infor-right"></div>
        </div>

      <!-- Nội dung Mô tả -->
      <div id="describe" class="content-section active">
        <div class="product-describe">
            <h4 class="product-describe-title">Mô tả</h4>
            <p class="product-description"><%= product.MoTa %></p>
        </div>
      </div>

      <!-- Nội dung Chứng chỉ xanh -->
      <div id="chungchi" class="content-section">
        <div class="product-ChungChiXanh">
          <% if (certificates.length > 0) { %>
            <% certificates.forEach(cert => { %>
                <div class="certificate-item">
                    <img src="/certificates/<%= cert.HinhDDX %>" alt="<%= cert.TenDDX %>" class="certificate-img">
                    <div class="certificate-info">
                        <p><strong><%= cert.TenDDX %></strong></p>
                        <p><%= cert.CoQuanCap %></p>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <p>Chưa có chứng chỉ xanh cho sản phẩm này.</p>
        <% } %>
        </div>
      </div>

      <!-- Nội dung review -->
      <div id="danhgia" class="content-section">
        <!--Testimonials------------------->
        <!-- Phần hiển thị đánh giá -->
    <% if (reviews.length > 0) { %>
        <section id="testimonials">
            <div class="testimonial-box-container">
                <% reviews.forEach(review => { %>
                    <div class="testimonial-box">
                        <!-- top -->
                        <div class="box-top">
                            <!-- profile -->
                            <div class="profile">
                                <div class="profile-img">
                                    <img src="/avatar/<%= review.Avatar || 'default-avatar.jpg' %>" alt="Avatar" />
                                </div>
                                <div class="name-user">
                                    <strong><%= review.HoUser %> <%= review.TenUser %></strong>
                                    <span>@<%= review.TenDangNhap %></span>
                                </div>
                            </div>
                            <!-- reviews -->
                            <div class="reviews">
                                <% for (let i = 0; i < review.DiemDanhGia; i++) { %>
                                    <i class="fas fa-star"></i>
                                <% } %>
                                <% for (let i = review.DiemDanhGia; i < 5; i++) { %>
                                    <i class="far fa-star"></i>
                                <% } %>
                            </div>
                        </div>
                        <!-- comments -->
                        <div class="client-comment">
                            <p><%= review.NDDanhGia %></p>
                            <small>Ngày đánh giá: <%= new Date(review.NgayDanhGia).toLocaleDateString('vi-VN') %></small>
                        </div>
                    </div>
                <% }); %>
            </div>
        </section>
    <% } else { %>
        <p>Chưa có đánh giá nào cho sản phẩm này.</p>
    <% } %>
      </div>

      <!--  -->
       </div>
     </div>
     <script src="/product-detail.js"></script>
     <script type="text/javascript" src="/main.js">
      
     </script>
     <script>
        function addToCart(productId, productPrice) {
            const quantity = parseInt(document.getElementById('quantity').value);
            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ productId, quantity, productPrice }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Sản phẩm đã được thêm vào giỏ hàng');
                } else {
                    alert('Không thể thêm sản phẩm vào giỏ hàng: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Đã xảy ra lỗi khi thêm sản phẩm vào giỏ hàng: ' + error.message);
            });
        }
        </script>
</body>
<footer>
    <div class="footer">
        <div class="footer-logo">
          <h1 class="footer-logo-text">ECOLINK FOR LIFE</h1>
        </div>
        <div class="footer-infor">
          <ul class="footer-infor-list">
            <li class="footer-infor-item">About us</li>
            <li class="footer-infor-item">News</li>
            <li class="footer-infor-item">Official Store</li>
            <li class="footer-infor-item">Company</li>
            <li class="footer-infor-item">Careers</li>
          </ul>
        </div>
      
        <div class="footer-infor">
          <ul class="footer-infor-list">
            <li class="footer-infor-item">Get Help</li>
            <li class="footer-infor-item">FAQ</li>
            <li class="footer-infor-item">Shipping</li>
            <li class="footer-infor-item">Payment</li>
            <li class="footer-infor-item">Returns</li>
            <li class="footer-infor-item">Contact Us</li>     
          </ul>
        </div>
        <div class="footer-infor">
          <ul class="footer-infor-list">
            <li class="footer-infor-item">Follow Us</li>
            <li class="footer-infor-item">
              <i class="fa-brands fa-facebook"></i>
              <i class="fa-brands fa-instagram"></i>
              <i class="fa-brands fa-youtube"></i>
              <i class="fa-brands fa-twitter"></i>
            </li>
          </ul>
        </div>
      </div>
      <div class="footer-year-guide">
        <a href="" class="footer-year-guide-item">Guide</a>
        <a href="" class="footer-year-guide-item">Terms & Conditions</a>
        <a href="" class="footer-year-guide-item">Privacy Policy</a>
      </div>
      <div class="footer-year">
        <i class="fa-regular fa-circle-check"></i>
        2024 ECOLINK. All Rights Reserved
      </div>
</footer>
</html>