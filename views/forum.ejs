<link rel="stylesheet" href="/forum.css">
<%- include('layout/mainpage_header') %>
    <!-- Blog main -->
    <div class="blog row">
        <div class="blog-contact col-md-3">
            <div class="blog-contact-avatar">
                <img class= "header-service-item-avatar-img" src="../image/avatar.jpg" alt="">
                <h4 class="blog-contact-avatar-name"><a href="" class="active">Ecolink for life</a></h4>
            </div>
           <div class="blog-contact-item-frame">
            <div class="blog-contact-item">
                <i class="fa-regular fa-calendar"></i>
                <span class="blog-contact-name" ><a href="">S·ª± ki·ªán</a></span>
            </div>
            <div class="blog-contact-item">
                <i class="fa-solid fa-arrow-trend-up"></i>
                <span class="blog-contact-name"><a href="">Xu h∆∞·ªõng</a></span>
            </div>
            <div class="blog-contact-item">
                <i class="fa-solid fa-heart-circle-check"></i>
                <span class="blog-contact-name"><a href="">Quan t√¢m</a></span>
            </div>
            <div class="blog-contact-item">
                <i class="fa-solid fa-gear" style="color: rgb(74, 74, 74);"></i>
                <span class="blog-contact-name"><a href="">C√†i ƒë·∫∑t</a></span>
            </div>
           </div>
        </div>
        <div class="blog-post col-md-6"  style="overflow-y: auto; max-height: 100vh;">
            <div class="blog-post-frame">
                <div class="blog-post-item">
                    <img class= "header-service-item-avatar-img" src="../image/avatar.jpg" alt="" style="margin-left: -px;">
                    <input class="blog-input" placeholder="B·∫£ng tin m·ªõi">
                    <div class="" >
                        <span class="blog-post-picture-vid"><i class="fa-regular fa-image"></i>·∫¢nh/Video</span>
                        <span class="blog-post-live"><i class="fa-solid fa-tv"></i>Tr·ª±c ti·∫øp</span>
                    </div>
                </div>
            </div>

            <!-- POPUP -POST -->
            <div class="overlay" id="overlay"></div>
            <div class="container-createPost" id="createPostPopup">
              <div class="wrapper-createPost">
                <section class="post">
                  <header>
                    T·∫°o b√†i vi·∫øt
                    <i class="fas fa-times" id="close-icon" style="cursor: pointer;"></i>
                  </header>
                
                  <form action="#">
                    <div class="content">
                      <img src="icons/logo.png" alt="logo">
                      <div class="details">
                        <p>H√¢n Nguy·ªÖn</p>
                        <div class="privacy">
                          <i class="fas fa-user-friends"></i>
                          <span>B·∫°n b√®</span>
                          <i class="fas fa-caret-down"></i>
                        </div>
                      </div>
                    </div>
                    <textarea id="contentInput" placeholder="H√¢n ∆°i, B·∫°n ƒëang nghƒ© g√¨ th·∫ø?" spellcheck="false" required></textarea>


                    <!-- Khung ch√®n ·∫£nh v√† video -->
                      <div class="media-upload" id="mediaUpload" style="display: none;">
                        <div class="upload-icon" id="uploadIcon">
                          <i class="fas fa-camera"></i> <!-- Bi·ªÉu t∆∞·ª£ng cho ·∫£nh -->
                          <span>Th√™m ·∫£nh/video</span>
                        </div>
                        <!-- Th√™m input file ·∫©n -->
                        <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
                    </div>
                      <!-- Hi·ªÉn th·ªã h√¨nh ·∫£nh ƒë√£ ch·ªçn -->
                      <div id="imagePreviewContainer" style="display: none;">
                        <img id="imagePreview" src="" alt="H√¨nh ·∫£nh ƒë√£ ch·ªçn" >
                      </div>
                    
                    

                    <div class="theme-emoji">
                      <img src="icons/theme.svg" alt="theme">
                      <img src="icons/smile.svg" alt="smile" onclick="toggleEmojiPicker()">
                    <!-- B·∫£ng ch·ªçn emoji -->
                  <div id="emojiPicker" class="emoji-picker" style="display: none;">
                    <span class="emoji" onclick="selectEmoji('üòä')">üòä</span>
                    <span class="emoji" onclick="selectEmoji('üòÉ')">üòÉ</span>
                    <span class="emoji" onclick="selectEmoji('üòÅ')">üòÅ</span>
                    <span class="emoji" onclick="selectEmoji('üòÇ')">üòÇ</span>
                    <span class="emoji" onclick="selectEmoji('üòç')">üòç</span>
                    <span class="emoji" onclick="selectEmoji('üòé')">üòé</span>
                    <span class="emoji" onclick="selectEmoji('üòú')">üòú</span>
                    <span class="emoji" onclick="selectEmoji('üò¢')">üò¢</span>
                    <span class="emoji" onclick="selectEmoji('üò°')">üò°</span>
                    <span class="emoji" onclick="selectEmoji('ü•≥')">ü•≥</span>
                    <span class="emoji" onclick="selectEmoji('üò±')">üò±</span>
                    <span class="emoji" onclick="selectEmoji('üòá')">üòá</span>
                    <span class="emoji" onclick="selectEmoji('üòÖ')">üòÖ</span>
                    <span class="emoji" onclick="selectEmoji('ü§î')">ü§î</span>
                    <span class="emoji" onclick="selectEmoji('ü§©')">ü§©</span>
                    <span class="emoji" onclick="selectEmoji('üòà')">üòà</span>
                    <span class="emoji" onclick="selectEmoji('ü§Ø')">ü§Ø</span>
                    <span class="emoji" onclick="selectEmoji('üòú')">üòú</span>
                    <span class="emoji" onclick="selectEmoji('ü§ó')">ü§ó</span>
                    <span class="emoji" onclick="selectEmoji('üëª')">üëª</span>
                    <span class="emoji" onclick="selectEmoji('üíÄ')">üíÄ</span>
                    <span class="emoji" onclick="selectEmoji('ü•∫')">ü•∫</span>
                    <span class="emoji" onclick="selectEmoji('üòã')">üòã</span>
                    <span class="emoji" onclick="selectEmoji('ü§ë')">ü§ë</span>
                    <span class="emoji" onclick="selectEmoji('üí©')">üí©</span>
                    <!-- Th√™m nhi·ªÅu emoji kh√°c n·∫øu c·∫ßn -->
                  </div>
                    </div>
                  

                  

                  
                    <div class="options">
                      <p>Th√™m v√†o b√†i vi·∫øt c·ªßa b·∫°n</p>
                      <ul class="list">
                        <li>
                          <img src="icons/gallery.svg" alt="gallery" onclick="showMediaUpload()">
                        </li>
                        <li>
                          <img src="icons/tag.svg" alt="tag" onclick="addHashtagToTextarea()">
                        </li>
                        <li>
                          <img src="icons/emoji.svg" alt="emoji" >
                        </li>
                        <li>
                          <img src="icons/mic.svg" alt="mic">
                        </li>
                        <li>
                          <img src="icons/more.svg" alt="more">
                        </li>
                      </ul>
                      
                      
                      
                    </div>
                    <button id="postButton">ƒêƒÉng</button>
                  </form>
                </section>
                <section class="audience">
                  <header>
                    <div class="arrow-back"><i class="fas fa-arrow-left"></i></div>
                    <p>ƒê·ªëi t∆∞·ª£ng c·ªßa b√†i vi·∫øt</p>
                  </header>
                  <div class="content">
                    <p>Ai c√≥ th·ªÉ th·∫•y b√†i vi·∫øt c·ªßa b·∫°n?</p>
                    <span>Your post will show up in News Feed, on your profile and in search results.</span>
                  </div>
                  <ul class="list">
                    <li>
                      <div class="column">
                        <div class="icon"><i class="fas fa-globe-asia"></i></div>
                        <div class="details">
                          <p>Public</p>
                          <span>Anyone on or off Facebook</span>
                        </div>
                      </div>
                      <div class="radio"></div>
                    </li>
                    <li class="active">
                      <div class="column">
                        <div class="icon"><i class="fas fa-user-friends"></i></div>
                        <div class="details">
                          <p>B·∫°n b√®</p>
                          <span>Your friends on Facebook</span>
                        </div>
                      </div>
                      <div class="radio"></div>
                    </li>
                    <li>
                      <div class="column">
                        <div class="icon"><i class="fas fa-user"></i></div>
                        <div class="details">
                          <p>Specific</p>
                          <span>Only show to some friends</span>
                        </div>
                      </div>
                      <div class="radio"></div>
                    </li>
                    <li>
                      <div class="column">
                        <div class="icon"><i class="fas fa-lock"></i></div>
                        <div class="details">
                          <p>Only me</p>
                          <span>Only you can see your post</span>
                        </div>
                      </div>
                      <div class="radio"></div>
                    </li>
                    <li>
                      <div class="column">
                        <div class="icon"><i class="fas fa-cog"></i></div>
                        <div class="details">
                          <p>Custom</p>
                          <span>Include and exclude friends</span>
                        </div>
                      </div>
                      <div class="radio"></div>
                    </li>
                  </ul>
                </section>
              </div>
            </div>

            <!--  BAI POST -->
            <% forum.forEach(forum => { %>
              <div class="blog-post-1" data-post-id="<%= forum.MaPost %>">
                  <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
                  <div class="blog-post-item-1">
                      <img 
                          class="header-service-item-avatar-img" 
                          src="<%= forum.AnhLogo %>" 
                          alt="Avatar" 
                          style="margin-left: 20px;">
                      
                          <span class="blog-post-contact-name">
                            <a href="#"><%= forum.TenCuaHang %></a>
                            <a 
                                href="#" 
                                class="follow-button" 
                                data-seller-id="<%= forum.MaNguoiBan %>" 
                                style="padding-left: 30px; color: rgb(30, 30, 204); text-decoration: none;"
                                onclick="toggleFollowSeller(event, '<%= forum.MaNguoiBan %>')"
                            >
                                Theo d√µi 
                                <i class="fa-solid fa-circle-check follow-icon" style="margin-left: 3px; display: none;"></i>
                            </a>

                            <!-- N√∫t Close -->
                            <button 
                                class="close-post" 
                                onclick="closePost('<%= forum.MaPost %>')"
                                aria-label="ƒê√≥ng b√†i vi·∫øt"
                            >
                                <i class="fa-solid fa-times"></i>
                            </button>
                          </span>
                        
                      <div class="blog-post-time"><%= forum.displayTime %></div>
              

                     <!-- N·ªôi dung b√†i vi·∫øt -->
                    <div 
                      class="blog-noidung" 
                      id="content-<%= forum.MaPost %>" 
                      data-full-content="<%= forum.NoiDung.replace(/"/g, '&quot;') %>"
                      >
                      <% if (forum.NoiDung.length > 200) { %>
                        <%- forum.NoiDung.substring(0, 200).replace(/\n/g, '<br>') %>...
                      <% } else { %>
                          <%- forum.NoiDung.replace(/\n/g, '<br>') %>
                      <% } %>
                    </div>
    

                      <!-- N√∫t Xem th√™m -->
                      <% if (forum.NoiDung.length > 200) { %>
                        <button class="btn-show-more" data-post-id="<%= forum.MaPost %>" onclick="showFullContent('<%= forum.MaPost %>')">
                        Xem th√™m
                        </button>
                      <% } %>
              
                      <% if (forum.Video) { %>
                      <div class="blog-post-video">
                          <iframe width="100%" height="315" src="<%= forum.Video %>" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                      </div>
                      <% } else if (forum.HinhAnh) { %>
                      <div class="blog-post-image">
                          <img class="blog-post-img" src="<%= forum.HinhAnh %>" alt="Post Image">
                      </div>
                      <% } %>
              
                      <!-- Ph·∫£n ·ª©ng b√†i vi·∫øt -->
                      <div class="blog-post-react-count">
                          <div class="blog-post-react-count-sp">
                              <i class="fa-solid fa-heart" style="color: red;"></i>
                              <i class="fa-solid fa-thumbs-up" style="color: blue;"></i>
                              <i class="fa-regular fa-face-smile" style="color: orange;"></i>
                          </div>
                          <div class="blog-post-react-count-num">
                              <span class="blog-post-react-like-num"><%= forum.SoLuotThich || 0 %> Th√≠ch</span>
                              <span style="margin-left: 15px;"><%= forum.SoLuotBinhLuan || 0 %> B√¨nh lu·∫≠n</span>
                          </div>
                      </div>
              
                      <!-- C√°c h√†nh ƒë·ªông -->
                      <div class="blog-post-react row" style="padding-top: 10px;">
                          <span 
                              class="blog-post-react-like col-md-6" 
                              data-post-id="<%= forum.MaPost %>"  
                              onclick="toggleLike(this)"
                          >
                              <i class="fa-regular fa-heart dis-like-icon" style="display: inline;"></i>
                              <i class="fa-solid fa-heart like-icon" style="display: none; color: red;"></i>
                              Like
                          </span>
                        
                          <span class="blog-post-react-cmt col-md-6">
                              <i class="fa-regular fa-comment" style="padding-right: 10px;"></i>Comment
                          </span>
                      </div>
                  </div>
              </div>
              <% }); %>
              
        </div>
        <div class="blog-contact-user col-md-3">
            <div class="blog-contact-user-title">ƒê∆∞·ª£c t√†i tr·ª£</div>
            <div class="blog-contact-user-item">
                <img class="blog-contact-user-img"src="../image/sp1.jpg">
                <div class="blog-contact-user-content-frame">
                    <h5 class="blog-contact-user-text" style="font-weight: 550;">Kiwi Collection</h5>
                    <p class="blog-contact-user-sub-text" style="margin-top: 30px; margin-left: 12px;">S·ªØa r·ª≠a m·∫∑t </p>
                </div>
            </div>
            <div class="blog-contact-user-item">
                <img class="blog-contact-user-img"src="../image/sp2.jpg">
                <div class="blog-contact-user-content-frame">
                    <h5 class="blog-contact-user-text" style="font-weight: 550;">White Grapefruit</h5>
                    <p class="blog-contact-user-sub-text" style="margin-top: 30px; margin-left: 12px;">S·ªØa t·∫Øm h∆∞∆°ng tr√°i c√¢y </p>
                </div>
            </div>
            <div class="blog-contact-user-item">
                <img class="blog-contact-user-img"src="../image/sp3.jpg">
                <div class="blog-contact-user-content-frame">
                    <h5 class="blog-contact-user-text" style="font-weight: 550;">Natural List</h5>
                    <p class="blog-contact-user-sub-text" style="margin-top: 30px; margin-left: 12px;">N∆∞·ªõc u·ªëng h∆∞∆°ng d√¢u</p>
                </div>
            </div>

        </div>     
    </div>
    <script>

      //XU LY THEO DOI
      // B·ªô l∆∞u tr·∫°ng th√°i c√°c ng∆∞·ªùi b√°n ƒë√£ theo d√µi (client-side)
      const followedSellers = new Set();

      // H√†m toggle (b·∫≠t/t·∫Øt) theo d√µi
      function toggleFollowSeller(event, sellerId) {
          event.preventDefault(); // NgƒÉn ƒëi·ªÅu h∆∞·ªõng m·∫∑c ƒë·ªãnh

          // X√°c ƒë·ªãnh n√∫t hi·ªán t·∫°i v√† icon theo d√µi
          const followButton = event.target.closest('.follow-button');
          const followIcon = followButton.querySelector('.follow-icon');

          // Ki·ªÉm tra tr·∫°ng th√°i theo d√µi hi·ªán t·∫°i
          if (followedSellers.has(sellerId)) {
              // N·∫øu ƒëang theo d√µi, h·ªßy theo d√µi
              followIcon.style.display = 'none';
              followButton.classList.remove('following');
              followButton.textContent = 'Theo d√µi ';
              followButton.appendChild(followIcon); // ƒê·∫£m b·∫£o icon v·∫´n ·ªü cu·ªëi
              followedSellers.delete(sellerId); // X√≥a kh·ªèi danh s√°ch theo d√µi

              // G·ª≠i y√™u c·∫ßu h·ªßy theo d√µi ƒë·∫øn server
              unfollowSeller(sellerId);
          } else {
              // N·∫øu ch∆∞a theo d√µi, b·∫≠t theo d√µi
              followIcon.style.display = 'inline';
              followButton.classList.add('following');
              followButton.textContent = 'ƒêang theo d√µi ';
              followButton.appendChild(followIcon); // ƒê·∫£m b·∫£o icon v·∫´n ·ªü cu·ªëi
              followedSellers.add(sellerId); // Th√™m v√†o danh s√°ch theo d√µi

              // G·ª≠i y√™u c·∫ßu theo d√µi ƒë·∫øn server
              followSeller(sellerId);
          }
      }

// H√†m g·ª≠i y√™u c·∫ßu theo d√µi t·ªõi server
function followSeller(sellerId) {
    fetch('/api/follow', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ sellerId: sellerId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log(`ƒêang theo d√µi ng∆∞·ªùi b√°n v·ªõi ID: ${sellerId}`);
        } else {
            console.error('Kh√¥ng th·ªÉ theo d√µi ng∆∞·ªùi b√°n');
        }
    })
    .catch(error => {
        console.error('L·ªói khi g·ª≠i y√™u c·∫ßu theo d√µi:', error);
    });
}

// H√†m g·ª≠i y√™u c·∫ßu h·ªßy theo d√µi t·ªõi server
function unfollowSeller(sellerId) {
    fetch('/api/unfollow', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ sellerId: sellerId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log(`ƒê√£ h·ªßy theo d√µi ng∆∞·ªùi b√°n v·ªõi ID: ${sellerId}`);
        } else {
            console.error('Kh√¥ng th·ªÉ h·ªßy theo d√µi ng∆∞·ªùi b√°n');
        }
    })
    .catch(error => {
        console.error('L·ªói khi g·ª≠i y√™u c·∫ßu h·ªßy theo d√µi:', error);
    });
}

      // Xu ly an bai post
      function closePost(postId) {
          // T√¨m b√†i vi·∫øt d·ª±a tr√™n ID
          const postElement = document.querySelector(`.blog-post-1[data-post-id="${postId}"]`);
          if (postElement) {
              // ·∫®n b√†i vi·∫øt b·∫±ng c√°ch th√™m class ho·∫∑c x√≥a kh·ªèi DOM
              postElement.style.display = 'none'; // ·∫®n b√†i vi·∫øt
              // postElement.remove(); // Ho·∫∑c x√≥a b√†i vi·∫øt kh·ªèi DOM
          }
      }



      // Xu ly dong - mo popup
      const input = document.querySelector('.blog-input');
      const popup = document.getElementById('createPostPopup');
      const overlay = document.getElementById('overlay');
      const closeIcon = document.getElementById('close-icon');

      // Hi·ªÉn th·ªã popup v√† overlay khi click v√†o input
      input.addEventListener('click', () => {
          popup.classList.add('active-popup');
          overlay.classList.add('active-popup');
      });

      // ƒê√≥ng popup khi click v√†o icon ƒë√≥ng
      closeIcon.addEventListener('click', () => {
          popup.classList.remove('active-popup');
          overlay.classList.remove('active-popup');
      });

      // ƒê√≥ng popup khi click v√†o overlay
      overlay.addEventListener('click', () => {
          popup.classList.remove('active-popup');
          overlay.classList.remove('active-popup');
      });




      function postContent(postId) {
          // L·∫•y n·ªôi dung t·ª´ textarea
          const contentInput = document.getElementById("contentInput").value;

          // Thay th·∫ø k√Ω t·ª± xu·ªëng d√≤ng (\n) b·∫±ng <br>
          const formattedContent = contentInput.replace(/\n/g, "<br>");

          // L·∫•y th·∫ª c√≥ id="content-" + postId
          const contentDisplay = document.getElementById("content-" + postId);
          if (contentDisplay) {
              // G·∫Øn n·ªôi dung ƒë√£ ƒë·ªãnh d·∫°ng v√†o th·∫ª
              contentDisplay.innerHTML = formattedContent;
          }
      }

      // G·ªçi h√†m v·ªõi id c·ª• th·ªÉ c·ªßa m·ªói b√†i vi·∫øt
      postContent('<%= forum.MaPost %>');


      // X·ª≠ l√Ω cho "Xem th√™m" khi b√†i vi·∫øt qu√° d√†i
      function showFullContent(postId) {
          const contentElement = document.getElementById(`content-${postId}`);
          if (contentElement) {
              // L·∫•y n·ªôi dung ƒë·∫ßy ƒë·ªß t·ª´ thu·ªôc t√≠nh data
              const fullContent = contentElement.getAttribute("data-full-content");
              if (fullContent) {
                  contentElement.textContent = fullContent; // Hi·ªÉn th·ªã n·ªôi dung ƒë·∫ßy ƒë·ªß
              }
          }

          // ·∫®n n√∫t "Xem th√™m"
          const button = document.querySelector(`button[data-post-id="${postId}"]`);
          if (button) {
              button.style.display = "none";
          }
      }




      // XU LY SU KIEN ADD HAGTAG #EVENT
      function addHashtagToTextarea() {
        const textarea = document.getElementById('contentInput');
        
        // Th√™m hashtag #event v√†o v·ªã tr√≠ con tr·ªè
        const cursorPosition = textarea.selectionStart; // L·∫•y v·ªã tr√≠ con tr·ªè hi·ªán t·∫°i
        const textBefore = textarea.value.substring(0, cursorPosition);
        const textAfter = textarea.value.substring(cursorPosition);

        // Ch√®n hashtag v√†o n·ªôi dung c·ªßa textarea
        textarea.value = textBefore + '#event' + textAfter;

        // ƒê·∫∑t l·∫°i con tr·ªè sau n·ªôi dung v·ª´a ch√®n
        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = cursorPosition + '#event'.length;
      }

      // XU LY SU KIEN ACTIVE AUDIENCE
      // L·∫•y t·∫•t c·∫£ c√°c m·ª•c trong danh s√°ch
      const listItems = document.querySelectorAll('.list li');
      const privacyIcon = document.querySelector('.content .privacy i:first-child');
      const privacyText = document.querySelector('.content .privacy span');

      // X·ª≠ l√Ω s·ª± ki·ªán click
      listItems.forEach(item => {
        item.addEventListener('click', () => {
          // X√≥a tr·∫°ng th√°i 'active' kh·ªèi c√°c m·ª•c
          listItems.forEach(i => i.classList.remove('active'));

          // Th√™m 'active' cho m·ª•c ƒë∆∞·ª£c click
          item.classList.add('active');

          // L·∫•y icon (class) t·ª´ th·∫ª <i> v√† text t·ª´ th·∫ª <p>
          const newIcon = item.querySelector('.icon i').className; // L·∫•y class c·ªßa <i>
          const newText = item.querySelector('.details p').textContent; // L·∫•y n·ªôi dung c·ªßa <p>

          // C·∫≠p nh·∫≠t icon v√† text trong ph·∫ßn hi·ªÉn th·ªã
          privacyIcon.className = newIcon; // Thay ƒë·ªïi class c·ªßa icon
          privacyText.textContent = newText; // Thay ƒë·ªïi n·ªôi dung text
        });
      });





      // XU LY HIEN THI EMOJI
      // H√†m ƒë·ªÉ hi·ªÉn th·ªã ho·∫∑c ·∫©n b·∫£ng emoji
      function toggleEmojiPicker() {
          const emojiPicker = document.getElementById("emojiPicker");
          const displayStyle = emojiPicker.style.display;

          // Chuy·ªÉn ƒë·ªïi gi·ªØa hi·ªÉn th·ªã v√† ·∫©n b·∫£ng emoji
          emojiPicker.style.display = displayStyle === "block" ? "none" : "block";
      }

      // H√†m ƒë·ªÉ ch·ªçn emoji v√† ch√®n v√†o textarea
      function selectEmoji(emoji) {
      const contentInput = document.getElementById("contentInput");
      contentInput.value += emoji; // Th√™m emoji v√†o cu·ªëi vƒÉn b·∫£n hi·ªán t·∫°i trong textarea

      // ƒê√≥ng b·∫£ng emoji sau khi ch·ªçn
      document.getElementById("emojiPicker").style.display = "none";
    }


      // XU LY LIKE ACTION
    // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng click v√†o Like
    async function toggleLike(spanElement) {
    const postId = spanElement.getAttribute('data-post-id'); // L·∫•y ID b√†i vi·∫øt t·ª´ data attribute
    const disLikeIcon = spanElement.querySelector('.dis-like-icon');
    const likeIcon = spanElement.querySelector('.like-icon');
    const likeCountSpan = spanElement.closest('.blog-post-react').previousElementSibling.querySelector('.blog-post-react-like-num');
    
    let likeCount = parseInt(likeCountSpan.textContent) || 0;
    const isLike = disLikeIcon.style.display === 'inline'; // Ki·ªÉm tra tr·∫°ng th√°i like (hi·ªÉn th·ªã like icon hay ch∆∞a)

    // C·∫≠p nh·∫≠t giao di·ªán (·∫©n/hi·ªán icon v√† c·∫≠p nh·∫≠t s·ªë l∆∞·ª£t th√≠ch)
    if (isLike) {
        disLikeIcon.style.display = 'none';
        likeIcon.style.display = 'inline';
        likeCount++;
    } else {
        likeIcon.style.display = 'none';
        disLikeIcon.style.display = 'inline';
        likeCount = Math.max(0, likeCount - 1);
    }

    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t th√≠ch tr√™n giao di·ªán
    likeCountSpan.textContent = `${likeCount} Th√≠ch`;

    // G·ª≠i y√™u c·∫ßu POST t·ªõi server ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i like cho b√†i vi·∫øt
    try {
        const response = await fetch('/api/updateLike', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                postId: postId,
                like: isLike // true n·∫øu like, false n·∫øu unlike
            })
        });

        const data = await response.json();
        if (!data.success) {
            console.error('C·∫≠p nh·∫≠t like th·∫•t b·∫°i:', data.message);
        }
    } catch (error) {
        console.error('L·ªói k·∫øt n·ªëi:', error);
    }
}

      // H√†m g·ª≠i y√™u c·∫ßu "like/unlike" l√™n server
    function sendLikeRequest(postId, isLike) {
      fetch(`/updateLike?postId=${postId}&like=${isLike}`, {
          method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
          if (!data.success) {
              console.error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i like:', data.message);
          }
      })
      .catch(error => console.error('L·ªói:', error));
  }
      
      // H√†m hi·ªÉn th·ªã khung ch√®n ·∫£nh/video
    function showMediaUpload() {
      // Hi·ªÉn th·ªã khung ch√®n ·∫£nh/video nh∆∞ng kh√¥ng k√≠ch ho·∫°t input file
      const mediaUpload = document.getElementById('mediaUpload');
      mediaUpload.style.display = 'block';

      // TƒÉng chi·ªÅu cao c·ªßa th·∫ª cha .container-createPost
      const container = document.querySelector('.container-createPost');
      container.style.height = '600px'; // Thay ƒë·ªïi chi·ªÅu cao t·ª´ 400px l√™n 600px
      }

    // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng click v√†o camera icon
    function triggerFileInput(type) {
      // Hi·ªÉn th·ªã khung ch√®n ·∫£nh/video
      document.getElementById('mediaUpload').style.display = 'block';

      // TƒÉng chi·ªÅu cao c·ªßa th·∫ª cha .container-createPost
      const container = document.querySelector('.container-createPost');
      container.style.height = '600px'; // Thay ƒë·ªïi chi·ªÅu cao t·ª´ 400px l√™n 600px

      // K√≠ch ho·∫°t s·ª± ki·ªán click tr√™n input file (ch·ªâ khi click v√†o camera)
      document.getElementById('fileInput').click();
    }

    function handleFileSelect(event) {
        const file = event.target.files[0]; // L·∫•y file t·ª´ input
        const imagePreviewContainer = document.getElementById('imagePreviewContainer'); // Container preview
        const imagePreview = document.getElementById('imagePreview'); // Th·∫ª <img> ƒë·ªÉ hi·ªÉn th·ªã ·∫£nh
        const mediaUpload = document.querySelector('.media-upload'); // Ph·∫ßn t·ª≠ mediaUpload

        if (file) {
            const reader = new FileReader();

            reader.onload = function(e) {
                // ƒê·∫∑t ngu·ªìn c·ªßa ·∫£nh l√† d·ªØ li·ªáu ƒë√£ ƒë·ªçc
                imagePreview.src = e.target.result;

                // Hi·ªÉn th·ªã container preview v√† ·∫©n media-upload
                imagePreviewContainer.style.display = 'block';
                mediaUpload.style.display = 'none';
            };

            reader.readAsDataURL(file); // ƒê·ªçc file d∆∞·ªõi d·∫°ng URL
        } else {
            // N·∫øu kh√¥ng c√≥ file, hi·ªÉn th·ªã l·∫°i media-upload v√† ·∫©n preview
            imagePreviewContainer.style.display = 'none';
            mediaUpload.style.display = 'flex';
        }
    }




      // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
      const uploadIcon = document.getElementById('uploadIcon');
      const fileInput = document.getElementById('fileInput');

      // Th√™m s·ª± ki·ªán click v√†o bi·ªÉu t∆∞·ª£ng t·∫£i l√™n
      uploadIcon.addEventListener('click', () => {
        // K√≠ch ho·∫°t input file khi ng∆∞·ªùi d√πng nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng camera
        triggerFileInput();
      });

      // L·∫Øng nghe s·ª± ki·ªán khi ng∆∞·ªùi d√πng ch·ªçn file
      fileInput.addEventListener('change', handleFileSelect);


      // X·ª≠ l√Ω hi·ªán pop-up
      document.addEventListener('DOMContentLoaded', () => {
      const input = document.querySelector('.blog-input');
      const popup = document.getElementById('createPostPopup');
      const overlay = document.getElementById('overlay');

      // Hi·ªÉn th·ªã popup v√† overlay khi click v√†o input
      input.addEventListener('click', () => {
        popup.classList.add('active-popup');
        overlay.classList.add('active-popup');
      });

      // ·∫®n popup v√† overlay khi click v√†o overlay
      overlay.addEventListener('click', () => {
        popup.classList.remove('active-popup');
        overlay.classList.remove('active-popup');
      });
    });


      const container = document.querySelector(".container-createPost"),
      privacy = container.querySelector(".post .privacy"),
      arrowBack = container.querySelector(".audience .arrow-back");
      privacy.addEventListener("click", () => {
        container.classList.add("active");
      });
      arrowBack.addEventListener("click", () => {
        container.classList.remove("active");
      });

     
    document.querySelector('#postButton').addEventListener('click', async () => {
    const NoiDung = document.querySelector('#contentInput').value.trim();
    const MaNguoiBan = 'NB001'; // L·∫•y t·ª´ th√¥ng tin ng∆∞·ªùi d√πng (v√≠ d·ª•: session)

    // L·∫•y t·ªáp ·∫£nh t·ª´ input file (n·∫øu c√≥)
    const fileInput = document.querySelector('#fileInput'); // Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt input file v·ªõi id l√† 'fileInput'
    const formData = new FormData();

    // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ƒë√£ ch·ªçn ·∫£nh
    if (fileInput.files.length > 0) {
        formData.append('HinhAnh', fileInput.files[0]); // Th√™m ·∫£nh v√†o FormData
    } else {
        console.error('Ch∆∞a ch·ªçn ·∫£nh.');
        alert('Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ ƒëƒÉng.');
        return;
    }

      // Th√™m n·ªôi dung b√†i vi·∫øt v√† m√£ ng∆∞·ªùi b√°n v√†o FormData
      formData.append('NoiDung', NoiDung);
      formData.append('MaNguoiBan', MaNguoiBan);

      // Ki·ªÉm tra n·ªôi dung b√†i vi·∫øt
      if (!NoiDung) {
          alert('N·ªôi dung kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.');
          return;
      }

        // Ti·∫øn h√†nh g·ª≠i y√™u c·∫ßu POST v·ªõi FormData (bao g·ªìm t·ªáp ·∫£nh)
        try {
            const response = await fetch('/api/create', {
                method: 'POST',
                body: formData,
            });

            const result = await response.json();
            if (response.ok) {
                console.log('B√†i vi·∫øt m·ªõi:', result.post);
                alert('ƒêƒÉng b√†i th√†nh c√¥ng.');
            } else {
                alert(result.error || 'ƒêƒÉng b√†i th·∫•t b·∫°i.');
            }
        } catch (err) {
            console.error('Error:', err);
            alert('L·ªói k·∫øt n·ªëi ƒë·∫øn server.');
        }
    });




    // H√†m hi·ªÉn th·ªã b√†i vi·∫øt m·ªõi
    // H√†m hi·ªÉn th·ªã b√†i vi·∫øt m·ªõi l√™n ƒë·∫ßu
    function addNewPost(post) {
    const postList = document.querySelector('#postList');
    const newPost = document.createElement('div');
    newPost.className = 'blog-post-1';
    newPost.innerHTML = `
        <div class="blog-post-item-1">
            <img 
                class="header-service-item-avatar-img" 
                src="${post.AnhLogo || '../image/avatar.jpg'}" 
                alt="Avatar" 
                style="margin-left: 20px;">
            <span class="blog-post-contact-name">
                <a href="#">${post.TenCuaHang}</a>
                <a href="#" style="padding-left: 30px; color: rgb(30, 30, 204);">
                    Theo d√µi 
                    <i class="fa-solid fa-circle-check" style="margin-left: 3px;"></i>
                </a>
            </span>
            <div class="blog-noidung">${post.NoiDung}</div>
            ${post.Video ? `
                <div class="blog-post-video">
                    <iframe width="100%" height="315" src="${post.Video}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                </div>
            ` : post.HinhAnh ? `
                <div class="blog-post-image">
                    <img class="blog-post-img" src="${post.HinhAnh}" alt="Post Image">
                </div>
            ` : ''}
            <div class="blog-post-react-count">
                <div class="blog-post-react-count-sp">
                    <i class="fa-solid fa-heart" style="color: red;"></i>
                    <i class="fa-solid fa-thumbs-up" style="color: blue;"></i>
                    <i class="fa-regular fa-face-smile" style="color: orange;"></i>
                </div>
                <div class="blog-post-react-count-num">
                    <span>${post.SoLuotThich || 0} Th√≠ch</span>
                    <span style="margin-left: 15px;">${post.SoLuotBinhLuan || 0} B√¨nh lu·∫≠n</span>
                </div>
            </div>
            <div class="blog-post-react row" style="padding-top: 10px;">
                <span class="blog-post-react-like col-md-6">
                    <i class="fa-regular fa-heart" style="padding-right: 10px;"></i>Like
                </span>
                <span class="blog-post-react-cmt col-md-6">
                    <i class="fa-regular fa-comment" style="padding-right: 10px;"></i>Comment
                </span>
            </div>
        </div>
    `;
        // Th√™m b√†i vi·∫øt m·ªõi v√†o ƒë·∫ßu danh s√°ch
        postList.prepend(newPost);
}


    </script>

</body>
<%- include('layout/footer')  %>