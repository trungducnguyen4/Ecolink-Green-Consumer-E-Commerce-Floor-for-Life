<%- include('layout/mainpage_header') %>
        <div class="personal-body row">
            <!-- NAVIGATION -->
            <div class="personal-body-navigation col-lg-3">
                <div class="personal-body-navigation-frame">
                    <!-- AVATAR -->
                    <div class="personal-body-avatar">
                        <div class="personal-body-avatar-frame">
                            <img src="./image/avatar.jpg" alt="" class="personal-body-avatar-img">
                            <div class="personal-body-avatar-name">Ecolink For Life</div>
                        </div>
                        <div class="personal-body-fix-frame">
                            <i class="fa-solid fa-wrench"></i>
                            <div class="personal-body-fix-text">Sửa hồ sơ</div>
                        </div>
                       
                    </div>
                    <!-- MY ACCOUNT -->
                    <div class="personal-body-my-account-frame">
                        <div class="personal-body-my-account-header-frame">
                            <i class="fa-solid fa-user"></i>
                            <div class="personal-body-my-account-text">Tài Khoản Của Tôi</div>
                        </div>
                        <ul class="personal-body-my-account-list">
                            <li class="personal-body-my-account-item" id="profile">Hồ Sơ</li>
                            <li class="personal-body-my-account-item" id="bank">Ngân Hàng</li>
                            <li class="personal-body-my-account-item" id="address">Địa Chỉ</li>
                            <li class="personal-body-my-account-item" id="password">Đổi Mật Khẩu</li>
                            <li class="personal-body-my-account-item" id="announcement">Cài Đặt Thông Báo</li>
                            <li class="personal-body-my-account-item" id="private">Những Thiết Lập Riêng Tư</li>
                        </ul>
                    </div>

                    <!-- ORDER -->
                     <a href="/purchaseOrderStatus" class="personal-body-order-frame">
                        <i class="fa-solid fa-bag-shopping"></i>
                        <div class="personal-body-my-account-text">Đơn Mua</div>
                     </a>
                      <!-- NOTIFICATION -->
                    <div class="personal-body-notification-frame">
                        <div class="personal-body-order-header-frame">
                            <i class="fa-regular fa-bell"></i>
                            <div class="personal-body-order-text">Thông Báo</div>
                        </div>
                        <ul class="personal-body-order-list">
                            <li class="personal-body-order-item">Cập Nhật Đơn Hàng </li>
                            <li class="personal-body-order-item">Khuyến mãi</li>
                        </ul>
                    </div>
                     
                </div>
                
            </div>
            <!-- DETAIL -->
            <div class="personal-body-detail col-lg-9">
                <!-- Detail-header -->
                <div class="personal-body-detail-header">
                    <div class="personal-body-detail-header-text">Hồ sơ của tôi</div>
                    <div class="personal-body-detail-header-subtext">Quản lý thông tin hồ sơ để bảo mật tài khoản</div>
                    <div class="personal-line"></div>
                </div>
                <!-- Detail-body -->
                 <div class="personal-body-detail-body">
                  <form id="personal-form" method="POST" enctype="multipart/form-data">
                    <div class="personal-body-detail-body-item-frame">
                        <label for="TenUser" class="personal-body-detail-body-lable col-lg-3">Tên</label>
                        <input type="text" id="TenUser" name="TenUser" class="personal-body-detail-body-item-input col-lg-6" value="<%= user.TenUser %>" >
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label for="Email" class="personal-body-detail-body-lable col-lg-3">Email</label>
                        <input type="email" id="Email" name="Email" class="personal-body-detail-body-item-input col-lg-6" value="<%= user.Email %>" >
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label for="SoDienThoai" class="personal-body-detail-body-lable col-lg-3">Số điện thoại</label>
                        <input type="text" id="SoDienThoai" name="SoDienThoai" class="personal-body-detail-body-item-input col-lg-6" value="<%= user.SoDienThoai %>" >
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label for="DiaChi" class="personal-body-detail-body-lable col-lg-3">Địa chỉ</label>
                        <input type="text" id="DiaChi" name="DiaChi" class="personal-body-detail-body-item-input col-lg-6" value="<%= user.DiaChi %>" >
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label class="personal-body-detail-body-lable col-lg-3">Giới tính</label>
                        <input type="radio" id="Nam" name="GioiTinh" value="Nam" <%= user.GioiTinh === 'Nam' ? 'checked' : '' %>> Nam
                        <input type="radio" id="Nu" name="GioiTinh" value="Nữ" <%= user.GioiTinh === 'Nữ' ? 'checked' : '' %>> Nữ
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label for="NgaySinh" class="personal-body-detail-body-lable col-lg-3">Ngày sinh</label>
                        <input type="date" id="NgaySinh" name="NgaySinh" class="personal-body-detail-body-date" value="<%= user.NgaySinh %>" >
                    </div>
                    <div class="personal-body-detail-body-item-frame">
                        <label for="Avatar" class="personal-body-detail-body-lable col-lg-3">Ảnh đại diện</label>
                        <input type="file" id="Avatar" name="Avatar" class="file-uploader">
                        <img id="previewAvatar" src="/avatar/<%= user.Avatar || 'default-avatar.jpg' %>" alt="Avatar" class="avatar-preview">
                    </div>
                
                    <!-- Nút lưu -->
                    <button type="submit" class="btn btn-success">Lưu thông tin</button>
                </form>
                
                 </div>
            </div>
        </div>
        <!-- Thêm SweetAlert2 vào để hiển thị pop-up -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // Lắng nghe sự kiện submit
    const form = document.getElementById('personal-form');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();  // Ngừng form gửi yêu cầu mặc định (refresh trang)
        
        const formData = new FormData(form);
        const data = {};

        // Lấy dữ liệu từ formData và chuyển thành đối tượng
        formData.forEach((value, key) => {
            data[key] = value;
        });

        try {
            const response = await fetch('/personal/updatePersonal', {
                method: 'POST',
                body: formData,  // Gửi dữ liệu form (bao gồm file avatar nếu có)
            });

            const message = await response.text();
            if (response.ok) {
                // Hiển thị thông báo thành công nếu server trả về OK
                Swal.fire({
                    icon: 'success',
                    title: 'Cập nhật thành công!',
                    text: message,
                    timer: 5000, // Hiển thị pop-up trong 2 giây
                    timerProgressBar: true, // Thêm thanh tiến trình
                });
                
                
            } else {
                // Hiển thị thông báo lỗi
                Swal.fire({
                    icon: 'error',
                    title: 'Có lỗi xảy ra!',
                    text: `Lỗi: ${message}`
                });
            }
        } catch (err) {
            console.error('Đã xảy ra lỗi:', err);
            Swal.fire({
                icon: 'error',
                title: 'Lỗi hệ thống',
                text: 'Đã xảy ra lỗi khi cập nhật thông tin.'
            });
        }
    });

</script>

</body>

<footer>
    <div class="footer">
      <div class="footer-logo">
        <h1 class="footer-logo-text">ECOLINK FOR LIFE</h1>
      </div>
      <div class="footer-infor">
        <ul class="footer-infor-list">
          <li class="footer-infor-item">About us</li>
          <li class="footer-infor-item">News</li>
          <li class="footer-infor-item">Official Store</li>
          <li class="footer-infor-item">Company</li>
          <li class="footer-infor-item">Careers</li>
        </ul>
      </div>
    
      <div class="footer-infor">
        <ul class="footer-infor-list">
          <li class="footer-infor-item">Get Help</li>
          <li class="footer-infor-item">FAQ</li>
          <li class="footer-infor-item">Shipping</li>
          <li class="footer-infor-item">Payment</li>
          <li class="footer-infor-item">Returns</li>
          <li class="footer-infor-item">Contact Us</li>     
        </ul>
      </div>
      <div class="footer-infor">
        <ul class="footer-infor-list">
          <li class="footer-infor-item">Follow Us</li>
          <li class="footer-infor-item">
            <i class="fa-brands fa-facebook"></i>
            <i class="fa-brands fa-instagram"></i>
            <i class="fa-brands fa-youtube"></i>
            <i class="fa-brands fa-twitter"></i>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-year-guide">
      <a href="" class="footer-year-guide-item">Guide</a>
      <a href="" class="footer-year-guide-item">Terms & Conditions</a>
      <a href="" class="footer-year-guide-item">Privacy Policy</a>
    </div>
    <div class="footer-year">
      <i class="fa-regular fa-circle-check"></i>
      2024 ECOLINK. All Rights Reserved
    </div>
  </footer>
</html>